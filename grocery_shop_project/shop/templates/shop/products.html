{% extends "shop/base.html" %}
{% block title %}รายการสินค้า{% endblock %}
{% block content %}
<h2>รายการสินค้า</h2>
{% if user.is_staff %}
  <p><a href="{% url 'shop:product_add' %}">+ เพิ่มสินค้า</a></p>
{% endif %}
<div class="product-list">
  {% for p in products %}
    <div class="product-card">
      <h4>{{ p.name }}</h4>
      <p>ราคา: {{ p.price }} บาท | คงเหลือ: {{ p.stock }}</p>
      <form action="{% url 'shop:cart_add' p.id %}" method="post">
        {% csrf_token %}
        <input name="quantity" type="number" value="1" min="1" max="{{ p.stock }}">
        <button type="submit">เพิ่มในตะกร้า</button>
      </form>
      {% if user.is_staff %}
        <p><a href="{% url 'shop:product_edit' p.id %}">แก้ไข</a> | <a href="{% url 'shop:product_delete' p.id %}">ลบ</a></p>
      {% endif %}
    </div>
  {% endfor %}
</div>
<hr>
<h3>ตะกร้าของคุณ</h3>
{% if cart_items %}
  <ul>
    {% for it in cart_items %}
      <li>{{ it.product.name }} x{{ it.quantity }} = {{ it.line_total }} บาท</li>
    {% endfor %}
  </ul>
  <p>รวม: {{ subtotal }} บาท</p>
  <p><a href="{% url 'shop:cart' %}">ดูตะกร้า / ชำระเงิน</a></p>
{% else %}
  <p>ตะกร้าว่าง</p>
{% endif %}
{% endblock %}
